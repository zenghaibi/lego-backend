### 1.注意添加用户数据是会报错

```
ERROR 36711 [-/::1/-/3ms POST /api/users/create] nodejs.TypeError: doc.ownerDocument is not a function
    at setDocumentTimestamps (/Users/sea/workspace/architect/egg/lego-backend/node_modules/mongoose/lib/helpers/timestamps/setDocumentTimestamps.js:9:9)
    at model.timestampsPreSave (/Users/sea/workspace/architect/egg/lego-backend/node_modules/mongoose/lib/helpers/timestamps/setupTimestamps.js:48:5)
    at callMiddlewareFunction (/Users/sea/workspace/architect/egg/lego-backend/node_modules/egg-mongoose/node_modules/kareem/index.js:483:23)
    at model.next (/Users/sea/workspace/architect/egg/lego-backend/node_modules/egg-mongoose/node_modules/kareem/index.js:58:7)
    at _next (/Users/sea/workspace/architect/egg/lego-backend/node_modules/egg-mongoose/node_modules/kareem/index.js:107:10)
    at /Users/sea/workspace/architect/egg/lego-backend/node_modules/egg-mongoose/node_modules/kareem/index.js:508:38
    at processTicksAndRejections (node:internal/process/task_queues:78:11)
```


**同学你好 查阅代码得知原因，你的 mongoose 单独安装了一下，是 6.1.4 的版本（其实不需要单独安装，egg-mongoose 安装的时候会安装适配的版本），而 egg-mongoose 依赖的是 5 版本的 mongoose，假如是新版本，然后加上 timestamp 选项就会报错。正如你提示的那个错误一样，**

| 12345678 | `const UserSchema = ``new` `Schema<UserProps>({``    ``username: { type: String, unique: ``true``, required: ``true` `},``    ``password: { type: String, required: ``true` `},``    ``nickName: { type: String },``    ``picture: { type: String },``    ``email: { type: String },``    ``phoneNumber: { type: String },``}, { timestamps: ``true` `});` |
| -------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |

如果吧 timestamps 选项删除就没有问题，所以应该是这个版本不匹配的问题。具体原因没有进行深究深层代码。

重新安装到5版本就可以了

| 1 | ` ``npm install mongoose@5.13.11 --save` |
| - | ---------------------------------------------- |
