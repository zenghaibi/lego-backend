### 更新以及删除

* 更新
  * PATCH /works/:id
  * payload: 和 create 一样
  * 返回：更新以后的数据
* 删除
  * DELETE /works/:id
  * 返回：删除的数据_id, id, title

**限制**

* 需要登录
* 只能编辑和删除自己的作品
  * 1根据ID 取得对应的作品
  * 2.判断作品的user 是否等于当前 state 中的 userID

```javascript
  // 权限检查
  async checkPerimssion(id: number) {
    const { ctx } = this;
    // 获取当前用户的ID
    const userId = ctx.state.user._id;
    // 查询作品信息
    const certianWork = await ctx.model.Work.findOne({ id });
    if (!certianWork) {
      return false;
    }
    // 检查是否相等，特别注决转换成字符串
    return certianWork.user.toString() === userId;
  }
  // 更新作品
  async update() {
    const { ctx } = this;
    const { id } = ctx.params;
    const permission = await this.checkPerimssion(parseInt(id));
    if (!permission) {
      return ctx.helper.error({ ctx, errorType: 'workNoPermissonFail' });
    }
    const payload = ctx.request.body;
    const res = await ctx.model.Work.findOneAndUpdate({ id }, payload, {
      new: true,
    }).lean();
    ctx.helper.success({ ctx, res });
  }
  // 删除作品
  async delete() {
    const { ctx } = this;
    const { id } = ctx.params;
    const permission = await this.checkPerimssion(parseInt(id));
    if (!permission) {
      return ctx.helper.error({ ctx, errorType: 'workNoPermissonFail' });
    }
    const res = await ctx.model.Work.findOneAndDelete({ id: parseInt(id) }).select('_id id title').lean();
    ctx.helper.success({ ctx, res });
  }
```
