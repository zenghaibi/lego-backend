#### 改进目前的部署流程

**目前线上更新的流程**

```bash
# 每次代码更新以后，登录到 ssh 服务器
# 关闭服务
# docker-compose down
# 更新代码
git pull
# 假如有 .env 有更新 需要重新高级设置 .env 文件
# 重新build 应用镜像
docker-compose build lego-backend
# 重启服务
docker-compose up -d
```

**目前问题的弊端**

* 初次上线和更新属于两步
* 初次上线需要特别的操作，就这是之前手动部署上线的过程
  * clone 代码
  * 设置环境变量.env
  * docker-compose up -d

**追求的成果：每次提交，可以自动一次性部署到任何服务器，实现初次启动或者更新的效果，**
**这才是一个完美的devops的流程**

**解决方案**

```yaml
# 目前的方案
services:
  leggo-redis:
    image: reids:6
  lego-mongo:
    image: mongo: lastest
  lego-backend:
    # 我们需要每次手动build镜像，也就是我们镜像只存在于本地
    build:
      context:
      dockerfile: Dockerfile
```
**更好的解决方案**
```yaml
# 更好的方案
# 不需任何代码库中的文件，只需要一个docker-compose.yml文件
# 就可以轻松的在任何服务器上运行
services:
  leggo-redis:
    image: reids:6
  lego-mongo:
    image: mongo: lastest
  lego-backend:
    # 不需要build,而是存于 docker hub 服务器中，可以每次直接拉取
    image: lego-backend：1.0.1
```
**阿里云容器镜像服务ACR**
地址：https://www.aliyun.com/product/acr
个人版完全免费

